<!DOCTYPE html>
<html lang="en">
<head>
    <!-- Required meta tags -->
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

    <!-- Bootstrap CSS -->
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0/css/bootstrap.min.css"
          integrity="sha384-Gn5384xqQ1aoWXA+058RXPxPg6fy4IWvTNh0E263XmFcJlSAwiGgFAW/dAiS6JXm"
          crossorigin="anonymous">

    <link href="//maxcdn.bootstrapcdn.com/font-awesome/4.7.0/css/font-awesome.min.css" rel="stylesheet">

    <!-- JS -->
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.12.9/umd/popper.min.js"
            integrity="sha384-ApNbgh9B+Y1QKtv3Rn7W3mgPxhU9K/ScQsAP7hUibX39j7fakFPskvXusvfa0b4Q"
            crossorigin="anonymous"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery-cookie/1.4.1/jquery.cookie.min.js"></script>

    <link href="{{ url_for('static', filename='css/mainpage.css') }}" rel="stylesheet">

    <!-- 구글폰트 -->
<!--    <link href="https://fonts.googleapis.com/css2?family=Black+Han+Sans&display=swap" rel="stylesheet">-->

    <title>Show Your Bucket!</title>

    <script>
        $(document).ready(function () {
            listing();
        });

        function listing() {
            $.ajax({
                type: "GET",
                url: "/buckets",
                data: {},
                success: function (response) {
                        let buckets = response['all_buckets']
                        for (let i = 0; i < buckets.length; i++) {
                            let title = buckets[i]['title']
                            let desc = buckets[i]['desc']
                            let file = buckets[i]['file']
                            let id = buckets[i]['_id']

                            let temp_html = `<div class="card" onclick="listing_detail('${id}')" style="cursor: pointer">
                                                <img src="../static/${file}" class="card-img-top">
                                                <div class="card-body">
                                                    <h5 class="card-title">${title}</h5>
                                                    <p class="card-text">${desc}</p>
                                                </div>
                                            </div>`
                            $('#buckets-box').append(temp_html)
                        }
                    }
                })
            }

        function listing_detail(id) {
            $('#bucket-modal-contents').empty()
            $("#bucket-modal").show();
                $.ajax({
                type: "GET",
                url: `/api/bucketdetail?id_give=${id}`,
                data: {},
                success: function (response) {
                        let bucket_detail = response['bucket_detail']
                            let title = bucket_detail['title']
                            let desc = bucket_detail['desc']
                            let file = bucket_detail['file']
                            let temp_html = `<div class="card">
                                                <div class="close" onclick=$("#bucket-modal").hide()>
                                                    <i class="fa fa-times" aria-hidden="true"></i>
                                                </div>
                                                <img src="../static/${file}" class="card-img-top">
                                                <div class="card-body">
                                                    <h5 class="card-title">${title}</h5>
                                                    <p class="card-text">${desc}</p>
                                                </div>
                                            </div>`
                            $('#bucket-modal-contents').append(temp_html)
                        }
                    })
            }

        function logout() {
                $.removeCookie('mytoken');
                alert('로그아웃 되었습니다!')
                window.location.href = '/'
            }

        function mp_posting() {
            if ($.cookie('mytoken')) {
                window.location.href = '/posting'
            } else {
                alert('로그인 먼저 부탁드려요~')
                window.location.href = '/login'
            }
        }

    </script>
</head>
<body>
    <div class="header">
        <img onclick="window.location.href='/'" class="logo" src="../static/img/logo.png">
    </div>
    <div class="intro">
        시간이 없는 거지, 하고 싶은 게 없는 건 아니잖아요?
    </div>
    <div class="main-btns">
        {% if state == 'login'%}
        <button type="button" class="login-btn" onclick="logout()">로그아웃</button>
        {% else %}
        <button type="button" class="login-btn" onclick="window.location.href='/login'">로그인</button>
        {% endif %}
        <button type="button" class="posting-btn" onclick="mp_posting()">작성하기</button>
    </div>
    <div id="buckets-box" class="card-columns">
    </div>

    <a href="#" onclick=$("#bucket-modal").show()>popuptest</a>

<!--버켓 보기 디테일-->
    <div id="bucket-modal" class="bucket-modal">
            <div id="bucket-modal-contents" class="bucket-modal-contents">
<!--                <img class="card-img-top"-->
<!--                     src="../static/${file}"-->
<!--                     alt="Card image cap">-->
<!--                <div class="card-body">-->
<!--                    <p>${title}</p>-->
<!--                    <p class="card-text">${desc}</p>-->
<!--                </div>-->
            </div>
        </div>
    </div>



</body>
</html>



